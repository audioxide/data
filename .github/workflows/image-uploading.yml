# This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Upload images to ImageKit

on: push

jobs:
  process:
    runs-on: ubuntu-latest
    steps:
    # Checkout repo
    - name: Checkout data
      uses: actions/checkout@v2
    # Setup node (including yarn)
    - name: Use Node.js 14
      uses: actions/setup-node@v1
      with:
        node-version: 14
    - run: yarn
      env:
        GITHUB_REGISTRY_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    - run: yarn run upload-images
      env:
        IMAGEKIT_PUBKEY: ${{ secrets.IMAGEKIT_PUBKEY }},
        IMAGEKIT_PRIVKEY: ${{ secrets.IMAGEKIT_PRIVKEY }},
        IMAGEKIT_URL: ${{ secrets.IMAGEKIT_URL }},
        GITHUB_REGISTRY_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        S3_ENDPOINT: ${{ secrets.IMAGE_STORE_S3_ENDPOINT }}
        S3_REGION: ${{ secrets.IMAGE_STORE_S3_REGION }}
        S3_ACCESS_KEY: ${{ secrets.IMAGE_STORE_S3_ACCESS_KEY }}
        S3_SECRET_KEY: ${{ secrets.IMAGE_STORE_S3_SECRET_KEY }}
        ORIGINALS_BUCKET: ${{ secrets.IMAGE_STORE_ORIGINALS_BUCKET }}
        PROCESSED_BUCKET: ${{ secrets.IMAGE_STORE_PROCESSED_BUCKET }}
